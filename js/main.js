(()=>{var s={q:t=>document.querySelector(t),qa:t=>document.querySelectorAll(t),gId:t=>document.getElementById(t),debounce(t,e,n){let o;return function(){let i=this,r=arguments;clearTimeout(o),o=setTimeout(function(){o=null,n||t.apply(i,r)},e),n&&!o&&t.apply(i,r)}},wrap(t,e,n={}){if(typeof e=="string"){e=document.createElement(e);for(let[o,i]of Object.entries(n))e.setAttribute(o,i)}t.parentNode.insertBefore(e,t),e.appendChild(t)},urlFor(t){return/^(#|\/\/|http(s)?:)/.test(t)?t:(window.ASYNC_CONFIG.root+t).replace(/\/{2,}/g,"/")},siblings:(t,e)=>[...t.parentNode.children].filter(n=>e?n!==t&&n.matches(e):n!==t),_message:[],message(t,e="success"){let n=document.createElement("div");n.className=`trm-message ${e}`,n.style.top=`${30+s._message.length*60}px`,n.innerText=t,document.body.append(n),s._message.push(n),setTimeout(()=>{s._message=s._message.filter(o=>o!==n),document.body.removeChild(n),s._message.forEach((o,i)=>{o.style.top=`${30+i*60}px`})},2e3)},loadScript(t,e){return new Promise((n,o)=>{if(e)n();else{let i=document.createElement("script");i.src=t,i.setAttribute("async","false"),i.onerror=o,i.onload=()=>n(),document.head.appendChild(i)}})},runScriptBlock(t){let e=t.text||t.textContent||t.innerHTML||"",n=document.head||document.querySelector("head")||document.documentElement,o=document.createElement("script");if(e.match("document.write"))return console&&console.log&&console.log("Script contains document.write. Can\u2019t be executed correctly. Code skipped "),!1;try{o.appendChild(document.createTextNode(e))}catch{o.text=e}n.appendChild(o),n.contains(o)&&n.removeChild(o)},icons(t,e="font"){return e==="symbol"?`<svg class="symbol-icon " aria-hidden="true"><use xlink:href="#${t}"></use></svg>`:`<i class="iconfont ${t}"></i>`},diffDate:(t,e=!1)=>{let n=new Date,o=new Date(t),i=n.getTime()-o.getTime(),r=1e3*60,c=r*60,a=c*24,f=a*30,p;if(e){let h=i/f,y=i/a,v=i/c,u=i/r;h>12?p=o.toISOString().slice(0,10):h>=1?p=parseInt(h.toString())+" "+window.ASYNC_CONFIG.date_suffix.month:y>=1?p=parseInt(y.toString())+" "+window.ASYNC_CONFIG.date_suffix.day:v>=1?p=parseInt(v.toString())+" "+window.ASYNC_CONFIG.date_suffix.hour:u>=1?p=parseInt(u.toString())+" "+window.ASYNC_CONFIG.date_suffix.min:p=window.ASYNC_CONFIG.date_suffix.just}else p=parseInt((i/a).toString());return p},getRandomItem(t){if(Array.isArray(t)){if(t.length===0)return;let e=Math.floor(Math.random()*t.length);return t[e]}return t},scrollBarWidth(){let t=document.createElement("div");t.className="async-scrollbar__wrap",t.style.visibility="hidden",t.style.width="100px",t.style.position="absolute",t.style.top="-9999px",document.body.appendChild(t);let e=t.offsetWidth;t.style.overflow="scroll";let n=document.createElement("div");n.style.width="100%",t.appendChild(n);let o=n.offsetWidth;return t.parentNode.removeChild(t),e-o}};var W=function(t=600){return new Promise(e=>{s.q("html").classList.add("is-animating"),s.q(".trm-scroll-container").style.opacity="0",setTimeout(function(){s.q("html").classList.remove("is-animating"),s.q(".trm-scroll-container").style.opacity="1",e()},t)})},_=function(t=600){let e=s.q("#trm-scroll-container"),n=s.q(".trm-mode-swich-animation-frame");return new Promise(o=>{n.classList.add("trm-active"),e.style.opacity="0",setTimeout(()=>{setTimeout(()=>{n.classList.remove("trm-active"),e.style.opacity="1"},t),o()},t)})},z=function(){document.body.classList.toggle("trm-single-column")},J=function(){let t=document.body;t.classList.add("trm-read-mode");let e=document.createElement("button");e.type="button",e.title=window.ASYNC_CONFIG.i18n.exit_read_mode,e.className="trm-exit-readmode trm-glow",e.innerHTML=s.icons(window.ASYNC_CONFIG.icons.close,window.ASYNC_CONFIG.icontype),t.appendChild(e);function n(){t.classList.remove("trm-read-mode"),e.remove(),e.removeEventListener("click",n)}e.addEventListener("click",n)},U=function(t){_().then(()=>{let e=t==="style-dark"?"add":"remove";s.q(".trm-mode-swich-animation").classList[e]("trm-active"),document.documentElement.classList[e]("dark"),localStorage.setItem("theme-mode",t),I(),typeof window.changeGiscusTheme=="function"&&window.changeGiscusTheme()})},I=function(t="--theme-bg-color"){let e=getComputedStyle(document.documentElement).getPropertyValue(t),n=s.q('meta[name="theme-color"]');e&&n&&(n.content=e)},V=function(){let t=s.q("#post-toc");t&&t.classList.toggle("active")},b={pageLoading:W,themeLoading:_,switchSingleColumn:z,switchReadMode:J,switchThemeMode:U,setThemeColor:I,showToc:V};var C=class{constructor(e){this.name="HeadPlugin";this.isSwupPlugin=!0;this.defaultOptions={persistTags:!1,persistAssets:!1,specialTags:!1};this.getHeadAndReplace=()=>{let e=this.getHeadChildren(),n=this.getNextHeadChildren();this.replaceTags(e,n)};this.getHeadChildren=()=>document.head.children;this.getNextHeadChildren=()=>{let e=this.swup.cache.getCurrentPage().originalContent.replace("<head",'<div id="swupHead"').replace("</head>","</div>"),n=document.createElement("div");n.innerHTML=e;let o=n.querySelector("#swupHead").children;return n.innerHTML="",n=null,o};this.replaceTags=(e,n)=>{let o=document.head,i=Boolean(document.querySelector("[data-swup-theme]")),r=this.getTagsToAdd(e,n,i),c=this.getTagsToRemove(e,n);c.reverse().forEach(a=>{o.removeChild(a.tag)}),r.forEach(a=>{o.insertBefore(a.tag,o.children[a.index+1]||null)}),this.swup.log(`Removed ${c.length} / added ${r.length} tags in head`)};this.compareTags=(e,n)=>{let o=e.outerHTML,i=n.outerHTML;return o===i};this.getTagsToRemove=(e,n)=>{let o=[];for(let i=0;i<e.length;i++){let r=null;for(let c=0;c<n.length;c++)if(this.compareTags(e[i],n[c])){r=c;break}r==null&&e[i].getAttribute("data-async-theme")===null&&!this.isMatchesTag(e[i],this.options.persistTags)&&o.push({tag:e[i]})}return o};this.getTagsToAdd=(e,n,o)=>{let i=[];for(let r=0;r<n.length;r++){let c=null;for(let a=0;a<e.length;a++)if(this.compareTags(e[a],n[r])){c=a;break}c==null&&!this.isMatchesTag(n[r],this.options.specialTags)&&i.push({index:o?r+1:r,tag:n[r]})}return i};this.isMatchesTag=(e,n=this.options.persistTags)=>typeof n=="function"?n(e):typeof n=="string"?e.matches(n):Boolean(n);this.updateHtmlLangAttribute=()=>{let e=document.documentElement,o=new DOMParser().parseFromString(this.swup.cache.getCurrentPage().originalContent,"text/html").documentElement.lang;e.lang!==o&&(this.swup.log(`Updated lang attribute: ${e.lang} > ${o}`),e.lang=o)};this.options={...this.defaultOptions,...e},this.options.persistAssets&&!this.options.persistTags&&(this.options.persistTags="link[rel=stylesheet], script[src], style")}mount(){this.swup.on("contentReplaced",this.getHeadAndReplace),this.swup.on("contentReplaced",this.updateHtmlLangAttribute)}unmount(){this.swup.off("contentReplaced",this.getHeadAndReplace),this.swup.off("contentReplaced",this.updateHtmlLangAttribute)}},H=C;var K=t=>Array.prototype.slice.call(t),E=class{constructor(e={}){this.name="ScriptPlugin";this.isSwupPlugin=!0;this.defaultOptions={selectors:"script[data-swup-reload-script]"};this.getScriptAndInsert=()=>{let e=this.getNextScriptChildren();e.length&&(async o=>{let i=Array.from(document.scripts);for(let r=0;r<o.length;r++){let c=o[r];c.src?i.findIndex(a=>a.src===c.src&&!a.dataset.reset)<0&&await this.loadScript(c):s.runScriptBlock(c)}})(e)};this.options={...this.defaultOptions,...e}}mount(){this.swup.on("contentReplaced",this.getScriptAndInsert)}unmount(){this.swup.off("contentReplaced",this.getScriptAndInsert)}loadScript(e){return new Promise((n,o)=>{let i=document.createElement("script");for(let{name:r,value:c}of K(e.attributes))i.setAttribute(r,c);i.textContent=e.textContent,i.setAttribute("async","false"),i.onload=()=>{n(),document.body.contains(i)&&document.body.removeChild(i)},i.onerror=o,document.body.appendChild(i)})}getNextScriptChildren(){let e=this.swup.cache.getCurrentPage().originalContent.replace("<body",'<div id="swupBody"').replace("</body>","</div>"),n=document.createElement("div");n.innerHTML=e;let o=n.querySelector("#swupBody").querySelectorAll(this.options.selectors);return n.innerHTML="",n=null,o}},A=E;function M(){window.Fancybox&&(window.Fancybox.bind("[data-fancybox]"),window.Fancybox.bind('[data-fancybox="light"],[data-fancybox="article"]',{groupAll:!0}),window.Fancybox.bind('[data-fancybox="dark"],[data-fancybox="article"]',{groupAll:!0}),window.Fancybox.defaults.Hash=!1)}function q(){if(window.Swiper)var t=new window.Swiper(".trm-slideshow",{slidesPerView:1,effect:"fade",parallax:!0,autoplay:!0,speed:1400})}function F(){window.Fancybox&&s.qa("#article-container img:not(.no-fancybox)").forEach(t=>{if(!t.parentNode.dataset.fancybox){let e="article";t.classList.contains("trm-light-icon")?e="light":t.classList.contains("trm-dark-icon")&&(e="dark"),s.wrap(t,"div",{"data-src":t.dataset.src||t.src,"data-fancybox":e})}})}function Q(){let t=[];t.push(new H({specialTags:"#trm-switch-style"})),t.push(new A);let e={containers:["#trm-dynamic-content"],animateHistoryBrowsing:!0,linkSelector:".trm-menu a:not([data-no-swup]), .trm-anima-link:not([data-no-swup])",animationSelector:'[class="trm-swup-animation"]',plugins:t};return new window.Swup(e)}function k(t=!1){let e=s.q("#trm-swich"),n=s.q(".trm-mode-swich-animation"),o=s.q(".trm-mode-swich-animation-frame");if(t){let i=(localStorage.getItem("theme-mode")||window.ASYNC_CONFIG.theme.default)=="style-dark",r=i?"add":"remove";n.classList[r]("trm-active"),o.classList.remove("trm-active"),b.setThemeColor(),e&&(e.checked=i)}e&&e.addEventListener("change",function(){b.switchThemeMode(this.checked?"style-dark":"style-light")})}function O(){let t=s.scrollBarWidth(),e=s.q("#trm-scroll-container"),n=s.q(".trm-banner-cover"),o=s.q(".trm-sidebar"),i=s.q("#trm-back-top"),r=s.q("#scroll-triger"),c=s.q(".trm-fixed-container"),a=new IntersectionObserver((u,l)=>{u.forEach(({isIntersecting:m,target:g})=>{m&&(g.classList.add("trm-active-el"),a.unobserve(g))})},{root:e,threshold:[0,1]}),f=function(u){window.scrollTo({top:0,behavior:u?"smooth":"auto"})},p=function(){let u=window.scrollY||window.pageYOffset||document.documentElement.scrollTop,{scrollHeight:l,clientHeight:m}=document.documentElement,g=u>500?"add":"remove";c==null||c.classList[g]("offset");let d=parseInt((u/(l-m)*100).toString());i&&(i.style.backgroundSize=`100% ${d}%`);let w=u>=70?"add":"remove";o&&o.classList[w]("fixed"),n&&(n.style.transform=`matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, ${Math.min(u/3,100)}, 0, 1)`)},h=function(){o&&(o.style.width=`${o.parentElement.clientWidth-40}px`)},y=function(){let u=s.q(".trm-banner");u&&window.scrollTo({top:u.clientHeight-20,behavior:"smooth"})};(()=>{s.qa(".trm-scroll-animation").forEach(l=>{l&&a.observe(l)}),p(),h()})(),i==null||i.addEventListener("click",f),r==null||r.addEventListener("click",y),window.addEventListener("scroll",p),window.addEventListener("resize",h),document.addEventListener("swup:contentReplaced",u=>{a.disconnect(),i==null||i.removeEventListener("click",f),r==null||r.removeEventListener("click",y),window.removeEventListener("scroll",p),window.removeEventListener("resize",h),f()})}function G(t=2e3){let e=(n,o,i,r)=>{i+=o,i>=r?n.innerText=r.toString():(n.innerText=parseInt(i.toString()).toString(),requestAnimationFrame(()=>e(n,o,i,r)))};s.qa(".trm-counter").forEach(n=>{let o=Number(n.innerText);if(!isNaN(o)){let i=o/(t/16);e(n,i,0,o)}})}function $(){let t=s.q("#post-toc"),e=s.q(".post-toc-btn");if(t){t.addEventListener("click",function(o){let i=o.target,r=i.getAttribute("href");if(r||(r=i.parentElement.getAttribute("href")),r){let c=document.querySelector(r);if(c){let a=c.getBoundingClientRect().top+(document.documentElement.scrollTop||window.pageYOffset||document.body.scrollTop);window.scrollTo({top:a-100,behavior:"smooth"})}}return o.preventDefault(),!1});let n=o=>{let i=r=>r===t||r===e?!0:r.parentElement?i(r.parentElement):!1;i(o.target)?t.classList.add("active"):t.classList.remove("active")};window.addEventListener("click",n),document.addEventListener("swup:contentReplaced",o=>{window.removeEventListener("click",n)})}}function X(){if(window.ASYNC_CONFIG.creative_commons){let{author:t,i18n:e,creative_commons:n}=window.ASYNC_CONFIG,o=function(i){let r=i.clipboardData||window.clipboardData;if(!r)return;let c=window.getSelection().toString();if(c){i.preventDefault();let a=document.getElementById("post-author");a&&(t=a.innerText.replace(`
`,""));let f=location.href,p=document.getElementById("original-link");p&&(f=p.innerText.replace(`
`,""));let h=`

${e.author}${t}
${e.copyright_link}${f}
${e.copyright_license_title}${e.copyright_license_content.replace("undefined","CC"+n.license.toUpperCase()+" "+(n.license=="zero"?"1.0":"4.0"))}`;r.setData("text/plain",c+h)}};document.addEventListener("copy",o)}}function P(){let{i18n:t,highlight:e,icons:n,icontype:o}=window.ASYNC_CONFIG,i=e.copy,r=e.lang,c=e.height_limit,a=i||r,f=e.plugin==="prismjs",p=e.title==="mac",h=f?'pre[class*="language-"]':"figure.highlight",y=s.qa(h);if(!(a||c||y.length))return;let v=function(){try{let l=this.parentNode.parentNode,m=l.querySelector(".code");if(m||(m=l.querySelector("table")),m||(m=l.querySelector("code")),!m)return;navigator.clipboard.writeText(m.innerText),s.message(t.copy_success)}catch{s.message(t.copy_failure,"warning")}},u=function(){var T,L,S;let l,m,g,d,w=(T=window==null?void 0:window.locomotiveScrollInstance)==null?void 0:T.scroll;if(l=this.classList.contains("expand-done"),g=this.parentElement.clientHeight,d=(S=(L=w==null?void 0:w.instance)==null?void 0:L.scroll)==null?void 0:S.y,this.classList.toggle("expand-done"),m=this.parentElement.clientHeight,l&&w){let N=g-m;if(N<w.scrollbarHeight)return;window.locomotiveScrollInstance.setScroll(w.instance.delta.x,d-N)}};s.qa(h).forEach(l=>{let m=document.createDocumentFragment(),g=document.createElement("div");if(g.className=`code-tools ${a&&p?"mac-style":"default-style"}`,r){let d="";f?d=l.getAttribute("data-language")?l.getAttribute("data-language"):"Code":(d=l.getAttribute("class").split(" ")[1],(d==="plain"||d===void 0)&&(d="Code"));let w=document.createElement("span");w.className="code-lang",w.innerText=d,g.append(w)}if(i){let d=document.createElement("span");d.className="copy-button",d.innerHTML=s.icons(n.copy,o),d.addEventListener("click",v),g.append(d)}if(c&&l.offsetHeight>e.height_limit+50){let d=document.createElement("div");d.innerHTML=s.icons(n.double_arrows,o),d.className="code-expand-btn",d.addEventListener("click",u),m.append(d)}if(m.append(g),f){s.wrap(l,"figure",{class:"highlight"}),l.parentNode.insertBefore(m,l);let d=l.querySelector(".caption,caption");d&&l.parentNode.appendChild(d)}else l.insertBefore(m,l.querySelector("table"))})}function Y(){s.qa(".trm-tabs .trm-tab > button").forEach(function(t){t.addEventListener("click",function(e){let n=this,o=n.parentNode;if(!o.classList.contains("active")){let i=o.parentNode.nextElementSibling,r=s.siblings(o,".active")[0];r&&r.classList.remove("active"),o.classList.add("active");let c=n.getAttribute("data-href").replace("#","");[...i.children].forEach(f=>{f.id===c?f.classList.add("active"):f.classList.remove("active")})}})})}function D(){let t=s.qa(".fj-gallery");t.length&&(t.forEach(e=>{e.querySelectorAll("img").forEach(o=>{o.loading="eager",s.wrap(o,"div",{class:"fj-gallery-item","data-src":o.dataset.src||o.src,"data-fancybox":"gallery"})})}),s.loadScript(window.ASYNC_CONFIG.plugin.flickr_justified_gallery,window.fjGallery).then(()=>{t.forEach(e=>{window.fjGallery(e,{itemSelector:".fj-gallery-item",rowHeight:220,gutter:4,onJustify:function(){this.$container.style.opacity="1"}})})}))}function Z(){if(window.ASYNC_CONFIG&&window.ASYNC_CONFIG.favicon.visibilitychange){window.originTitle=document.title;let t,e=Array.from(s.qa('[rel="icon"]')),n=e.map(o=>o.href);document.addEventListener("visibilitychange",function(){document.hidden?(e.forEach(o=>{o.href=s.urlFor(window.ASYNC_CONFIG.favicon.hidden)}),document.title=window.ASYNC_CONFIG.favicon.hideText,clearTimeout(t)):(e.forEach((o,i)=>{o.href=n[i]}),document.title=window.ASYNC_CONFIG.favicon.showText+window.originTitle,t=setTimeout(function(){document.title=window.originTitle},2e3))})}}function B(){let{notice_outdate:t,i18n:e}=window.ASYNC_CONFIG;if(t){let n=s.diffDate(window.PAGE_CONFIG.postUpdate);if(n>=t.limit_day){let o=document.createElement("div");o.className=`post-outdate-notice ${t.position}`,o.textContent=e.notice_outdate_message.replace("undefined",n.toString());let i=document.getElementById("article-container");t.position==="top"?i.insertBefore(o,i.firstChild):i.appendChild(o)}}}function R(){if(window.ASYNC_CONFIG.covers&&window.PAGE_CONFIG.isHome){let t=window.ASYNC_CONFIG.covers;s.qa("div[data-random-img]").forEach(n=>{let o=s.getRandomItem(t);o+=o.includes("?")?`&v=${Math.random()}`:`?v=${Math.random()}`,o&&(n.style.backgroundImage=`url(${o})`)})}}function j(){s.q(".trm-menu-btn").addEventListener("click",function(){s.q(".trm-menu-btn,.trm-right-side").classList.toggle("trm-active")})}function ee(){let t=e=>console.log(e,"color: white; background: #0078E7; padding:5px 0;margin: 0 0 2px 0;border-radius: 4px 0 0 4px;","padding: 4px;border:1px solid #0078E7;border-radius: 0 4px 4px 0; background: linear-gradient(70deg, #e3f9eb, #d1dbff);");t(`%c \u{1F680} Hexo-Theme-Async ${window.ASYNC_CONFIG.theme_version=="0.0.0"?"Github":window.ASYNC_CONFIG.theme_version} %c https://github.com/MaLuns/hexo-theme-async `),t("%c \u{1F4D1} Hexo-Theme-Async Docs %c https://hexo-theme-async.imalun.com ")}function x(){window.asyncFun=b,ee(),b.pageLoading(),Z(),window.PAGE_CONFIG.isPost&&B(),D(),F(),P(),Y(),window.ASYNC_CONFIG.swup&&Q(),j(),k(!0),G(),O(),q(),M(),$(),X(),R(),window.ASYNC_CONFIG.swup&&document.addEventListener("swup:contentReplaced",function(){let t=s.gId("async-page-config");t&&s.runScriptBlock(t),window.PAGE_CONFIG.isPost&&B(),j(),document.body.classList.remove("trm-read-mode"),window.show_date_time&&window.show_date_time(),D(),F(),P(),Y(),s.q(".trm-scroll-container").style.opacity="1",k(!0),G(),O(),q(),M(),$(),R()})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",x):x();})();
